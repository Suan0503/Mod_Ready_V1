<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>茗殿專用查詢系統</title>
    <link rel="icon" href="/static/myicon.png">
    <style>
        :root{
            --brand:#7c4dff;
            --brand-d:#512da8;
            --bg1:#f6e9ff;
            --bg2:#c2e9fb;
        }
        *{box-sizing:border-box}
        body {
            font-family: "微軟正黑體", Arial, sans-serif;
            background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 100%);
            color: #333;
            margin:0;
        }
        .container {
            max-width: 520px;
            margin: 40px auto 80px auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 16px #c3a6e9;
            padding: 32px 30px;
        }
        h2 {
            margin: 6px 0 18px 0;
            color: var(--brand);
            letter-spacing: 2px;
            text-align:center;
        }
        label { font-weight: bold; font-size: 1.0em; }
        input[type="text"] {
            width: 220px;
            font-size: 1em;
            padding: 9px 10px;
            border-radius: 8px;
            border: 1.5px solid var(--brand);
        }
        button {
            padding: 9px 18px;
            font-size: 1em;
            border-radius: 8px;
            border: none;
            background: var(--brand);
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: background .2s;
        }
        button:hover { background: var(--brand-d); }
        .result { margin-top: 24px; }
        .white { color: green; font-weight: bold; }
        .black { color: red; font-weight: bold; }
        .none { color: #888; }
        .logo {
            display: block;
            width: 72px;
            margin:0 auto 16px auto;
        }
        .flash{margin:8px 0;padding:10px;border-radius:8px;background:#f9f7ff;border:1px solid #d6c9ff;color:#4a2fbf;text-align:center;}
        .muted{color:#777;font-size:0.92em}
        .footer{text-align:center;color:#777;margin-top:26px;font-size:12px}
    </style>
</head>
<body>
  <div class="container">
    <img src="/static/logo.png" alt="Logo" class="logo">
    <h2>茗殿專用查詢系統</h2>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for m in messages %}
          <div class="flash">🌸 {{ m }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <form method="post" style="display:flex;align-items:end;gap:10px;margin-bottom:8px;">
        <label for="phone">請輸入電話：</label>
        <input type="text" name="phone" id="phone" value="{{ phone }}" placeholder="例如 0912345678">
        <button type="submit">查詢</button>
    </form>
    <div class="result">
    {% if searched %}
        <hr>
        <h4>查詢結果</h4>
        {% if search_result %}
            {% for result in search_result %}
                {% if result.type == 'white' %}
                    <div class="white">
                        <b>白名單</b>：{{ result.record.name }}（{{ result.record.phone }}）
                        {% if result.record.line_id %}，LINE ID: {{ result.record.line_id }}{% endif %}
                        {% if result.record.reason %}<br>原因：{{ result.record.reason }}{% endif %}
                        <div class="muted">建立於 {{ result.record.created_at }}，最後更新 {{ result.record.updated_at }}</div>
                    </div>
                {% elif result.type == 'black' %}
                    <div class="black">
                        <b>黑名單</b>：{{ result.record.name }}（{{ result.record.phone }}）
                        {% if result.record.reason %}<br>原因：{{ result.record.reason }}{% endif %}
                        <div class="muted">建立於 {{ result.record.created_at }}，最後更新 {{ result.record.updated_at }}</div>
                    </div>
                {% endif %}
                <hr>
            {% endfor %}
        {% else %}
            <div class="none">查無此電話於白/黑名單。</div>
        {% endif %}
    {% endif %}
    </div>
    <div class="footer">© {{ now.year }} 茗殿 | 小幫手糖糖 ฅ^•ﻌ•^ฅ</div>
  </div>
</body>
</html>
